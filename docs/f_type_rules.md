# F型アクセント結合規則 (F-type Accent Combination Rules)

日本語の動詞・形容詞に接尾辞（助動詞、助詞など）が付く際、アクセント核の位置は **F型規則** によって決定されます。これはUniDicの `aConType`（アクセント結合型）フィールドに記録されています。

## 基本概念

### 記号の定義

- **M1**: 前部要素（語幹）のアクセント型（0=平板、k=k拍目に核）
- **N1**: 前部要素のモーラ数
- **M**: F規則のパラメータ（位置オフセット）
- **L**: F6規則の第2パラメータ

### F型規則一覧

| 規則 | 動作 | 数式 |
|------|------|------|
| F1 | 前部アクセント保持 | 結果 = M1 |
| F2 | 平板なら境界、それ以外保持 | M1=0 → N1+M, else M1 |
| F3 | 平板なら平板、それ以外シフト | M1=0 → 0, else N1+M |
| F4 | 常に境界にシフト | 結果 = N1+M |
| F5 | 常に平板化 | 結果 = 0 |
| F6 | 平板ならM、起伏ならL | M1=0 → N1+M, else N1+L |

## 規則の詳細と例

### F1: 前部アクセント保持

接尾辞は語幹のアクセントに影響を与えません。

```
て形（F1）:
  書く[1] + て → 書いて[1] (HLL + L = HLLL)
  食べる[2] + て → 食べて[2] (LHL + L = LHLL)
```

### F2: 条件付き境界シフト

平板型の語幹の場合のみ、境界（語幹末＋M）にアクセント核を置く。起伏型なら保持。

```
た形（動詞: F2@1）:
  行く[0] + た → 行った[3] (LHH + L = LHHL) ← 平板だったので N1+1=3
  書く[1] + た → 書いた[1] (HL + LL = HLLL) ← 起伏だったので保持
```

### F3: 条件付き平板維持

平板型の語幹は平板を維持。起伏型は境界にシフト。

```
ない形（動詞: F3@0）:
  行く[0] + ない → 行かない[0] (LHH + HH = LHHHH) ← 平板維持
  書く[1] + ない → 書かない[2] (HL + LLL = LHLLL) ← N1+0=2にシフト

られる形（動詞: F3@2）:
  食べる[2] + られる → 食べられる[4] ← N1+2=4
  見る[1] + られる → 見られる[3] ← N1+2=3
```

### F4: 強制境界シフト

アクセント核は常に指定位置に移動。

```
ます形（動詞: F4@1）:
  行く[0] + ます → 行きます[3] (LHH + LL = LHHLL) ← N1+1=3
  書く[1] + ます → 書きます[3] (LHH + LL = LHHLL) ← N1+1=3
  食べる[2] + ます → 食べます[3] (LHH + LL = LHHLL) ← N1+1=3
```

### F5: 強制平板化

結果は常に平板になる。

```
（本ツールでは主に名詞接続で使用）
```

### F6: 二重条件分岐

平板ならMを使用、起伏ならLを使用。

```
たり形（動詞: F6@1,-1）:
  行く[0] + たり → N1+1=3
  書く[1] + たり → N1+(-1)=1
```

## UniDicでの表記

UniDicの `aConType` フィールドは以下の形式で記録されています：

```
動詞%F2@1,形容詞%F4@-2
```

これは：
- 動詞に接続する場合: F2規則、M=1
- 形容詞に接続する場合: F4規則、M=-2

### 実際の例（accent_rules.jsonより）

```json
{
  "ます|助動詞|*|助動詞-マス": {
    "surface": "ます",
    "aConType": {
      "動詞": {"type": "F4", "M": 1, "L": null}
    }
  },
  "た|助動詞|*|助動詞-タ": {
    "surface": "た",
    "aConType": {
      "動詞": {"type": "F2", "M": 1, "L": null},
      "形容詞": {"type": "F4", "M": -2, "L": null}
    }
  },
  "ない|助動詞|*|助動詞-ナイ": {
    "surface": "ない",
    "aConType": {
      "動詞": {"type": "F3", "M": 0, "L": null}
    }
  }
}
```

## 活用形修飾型（aModType）

語幹自体の変形（連用形など）でアクセントが変化する場合、`aModType` で記述されます。

### M4@n: アクセント位置シフト

語幹が短縮された際、アクセント核を n だけ前にシフト。

```
M4@1 の例:
  食べる[2] → 食べ（連用形）[1]
  基本形の2から1を引いて、連用形は[1]になる
```

### M1@n: アクセント位置固定

特定の形（意志形など）で、アクセント核を n に固定。

```
M1@1 の例:
  書こう（意志形）→ [1] に固定
```

## 実装コード

```python
def apply_f_rule(f_type, m_val, l_val, prev_accent, prev_mora):
    m = m_val if m_val is not None else 0
    l = l_val if l_val is not None else 0

    if f_type == "F1":
        return prev_accent
    elif f_type == "F2":
        return prev_mora + m if prev_accent == 0 else prev_accent
    elif f_type == "F3":
        return 0 if prev_accent == 0 else prev_mora + m
    elif f_type == "F4":
        return prev_mora + m
    elif f_type == "F5":
        return 0
    elif f_type == "F6":
        return prev_mora + m if prev_accent == 0 else prev_mora + l
    else:
        return prev_accent
```

## 計算例: 「食べられません」

```
入力: 食べる[2] + られる + ません

1. 食べ（連用形）: aModType=M4@1 → 2-1=1 → [1], 2モーラ
2. + られる: F3@2
   - 前部が起伏[1] → N1+M = 2+2 = 4
   - 結果: 食べられ[4], 4モーラ
3. + ません: F4@1
   - N1+M = 4+1 = 5
   - 結果: 食べられません[5]

パターン: LHHHHLL
```

## 精度と限界

F型規則は UniDic に基づいており、高い精度を持ちますが：

1. **未登録語**: 辞書にない語はデフォルト処理
2. **複合動詞**: 一部の複合動詞は特殊なアクセントパターンを持つ
3. **話者差**: 特に若年層で規則から外れる発音もある

## 参考文献

- UniDic ドキュメント: https://clrd.ninjal.ac.jp/unidic/
- 峯松信明・広瀬啓吉（2003）「韻律情報を利用した形態素解析」
- 田中穂積編（2002）『言語と計算5　形態素・形態論』東京大学出版会
